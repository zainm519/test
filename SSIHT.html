<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Explosion Alarme</title>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
  </head>
  <body>
    <a-scene>
      <!-- Assets -->
      <a-assets>
        <a-asset-item id="alar" src="./alarme.glb"></a-asset-item>
        <img id="salless" src="./sallessihtb.jpg" />
      </a-assets>

      <!-- Ciel -->
      <a-sky src="#salless"></a-sky>

      <!-- Caméra -->
      <a-entity camera position="0 1.6 0" look-controls>
        <a-entity cursor="rayOrigin: mouse"></a-entity>
      </a-entity>

      <!-- Alarme -->
      <a-entity id="alarme"
                gltf-model="#alar"
                position="0 0 -4"
                scale="2 2 2"
                class="clickable">
        <a-entity id="alarme" gltf-model="./alarme.glb" position="-4.67544 -3.58794 7.01382" scale="2 2 2" class="clickable" rotation="2.2906852649330314 89.65815465545663 -0.13063437728982769">
      </a-entity>
      </a-entity>
    </a-scene>

    <script>
      const alarm = document.querySelector('#alarme');

      alarm.addEventListener('click', () => {
        if (alarm.classList.contains('triggered')) return;
        alarm.classList.add('triggered');

        // 1. Ajouter un effet de feu (flamme + lumière) sur l'objet
        const flameLight = document.createElement('a-entity');
        flameLight.setAttribute('light', 'type: point; intensity: 2.0; color: orange; distance: 5; decay: 2');
        flameLight.setAttribute('position', '0 1 0');
        alarm.appendChild(flameLight);

        const flame = document.createElement('a-sphere');
        flame.setAttribute('position', '0 1 0');
        flame.setAttribute('radius', '0.3');
        flame.setAttribute('material', 'color: orange; emissive: red; opacity: 0.6; transparent: true');
        flame.setAttribute('animation', 'property: scale; to: 1.3 1.5 1.3; dir: alternate; dur: 200; loop: true');
        alarm.appendChild(flame);

        // 2. Après 3 secondes : explosion
        setTimeout(() => {
          // Enlever le feu
          flame.remove();
          flameLight.remove();

          // Cacher l'alarme
          alarm.setAttribute('visible', 'false');

          // Explosion visuelle
          triggerExplosion(alarm.getAttribute('position'));
        }, 3000);
      });

      function triggerExplosion(pos) {
        const scene = document.querySelector('a-scene');

        // Boule d'explosion
        const blast = document.createElement('a-sphere');
        blast.setAttribute('position', pos);
        blast.setAttribute('radius', '0.5');
        blast.setAttribute('material', 'color: orange; emissive: red; opacity: 0.9; transparent: true');
        blast.setAttribute('animation__scale', 'property: scale; to: 6 6 6; dur: 500; easing: easeOutQuad');
        blast.setAttribute('animation__fade', 'property: material.opacity; to: 0; dur: 600; delay: 200');
        scene.appendChild(blast);

        setTimeout(() => {
          blast.remove();
        }, 1200);

        // Débris
        for (let i = 0; i < 10; i++) {
          const debris = document.createElement('a-box');
          debris.setAttribute('position', `${pos.x} ${pos.y + 1} ${pos.z}`);
          debris.setAttribute('width', '0.1');
          debris.setAttribute('height', '0.1');
          debris.setAttribute('depth', '0.1');
          debris.setAttribute('material', 'color: gray; opacity: 1');

          const angle = Math.random() * Math.PI * 2;
          const speed = Math.random() * 2 + 0.5;
          const vx = Math.cos(angle) * speed;
          const vz = Math.sin(angle) * speed;
          const vy = Math.random() * 2;

          const targetX = pos.x + vx;
          const targetY = pos.y + 1 + vy;
          const targetZ = pos.z + vz;

          debris.setAttribute('animation', `property: position; to: ${targetX} ${targetY} ${targetZ}; dur: 1000`);
          debris.setAttribute('animation__fade', 'property: material.opacity; to: 0; dur: 800; delay: 300');

          scene.appendChild(debris);

          setTimeout(() => debris.remove(), 1500);
        }
      }
    </script>
  </body>
</html>
